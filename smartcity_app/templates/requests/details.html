{% extends "navbar_base.html" %}
{% block content %}

<h1>#{{ serviceRequest.id }}</h1>
<br>
<h2>
    {% if request.state == 'Finished' %}
    <span class="badge bg-success"> {{ request.state }} </span>
    {% elif request.state == 'In Progress' %}
    <span class="badge bg-warning"> {{ request.state }} </span>
    {% elif request.state == 'Open' %}
    <span class="badge bg-primary"> {{ request.state }} </span>
    {% endif %}
</h2>

<div class="top-50 start-50">
    Description: <br>
    <p><strong>{{ serviceRequest.description }}</strong></p>
    Date Created: {{ serviceRequest.created_timestamp }} <br>
    Priority: {{ serviceRequest.priority }} <br>
    Officer (Author):
    <a href="{% url 'user-view' id=serviceRequest.authorid.id %}">
        {{ serviceRequest.authorid.name }} {{ serviceRequest.authorid.surname }}
    </a>
    <br>
    {% if currentUserData.role == 'Officer' %}
    <form action="" method="POST">
        {% csrf_token %}
        Assigned Technician: {{ assign_form.technicianid }}
    </form>
    {% else %}
        {% if serviceRequest.technicianid %}
        Assigned Technician: <a href="{% url 'user-view' id=serviceRequest.technicianid.id %}">
            {{ serviceRequest.technicianid.name }} {{ serviceRequest.technicianid.surname }}
        </a>
        {% else %}
        Assigned Technician: <i>No Technician assigned.</i>
        {% endif %}
        <br>
    {% endif %}
    Relevant Ticket:
    <a href="{% url 'ticket-details' id=serviceRequest.ticketid.id %}">
        {{ serviceRequest.ticketid.title }}
    </a>
    <br>
    <!-- TODO: -->
    Expected Completion Date: ...
    Estimated Expenses: ...
</div>


<h2>
    Comments
</h2>


<form action="." method="POST">
    {% csrf_token %}
    <div class="mb-1">
        New comment:
    </div>
    {{ comment_form.text }}
    <div class="pe-2 col text-end">
        <button type="submit" class="btn btn-outline-primary mt-2">Submit</button>
    </div>
</form>


{% for comment in comments %}
<p>
    <div class="bg-secondary m-3 px-1 pb-2 row rounded" style="--bs-bg-opacity: .3">
        <div class="col-md-6 text-start ">
                <a href="/user/{{comment.AuthorId}}/">
                <p class="fs-6">{{ comment.AuthorName}}</p>
            </a>
            </div>
        <div class="col-md-6 text-end fs-6">
            {{ comment.timestamp }}
        </div>
        <div class="col-md-6 text-start fs-5">
            {{comment.text}}
        </div>
    </div>
</p>
{% endfor %}



{% endblock content %}